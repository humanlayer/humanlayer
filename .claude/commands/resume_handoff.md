---
description: 透過上下文分析和驗證從交接文件恢復工作
---

# 從交接文件恢復工作

你的任務是透過互動過程從交接文件恢復工作。這些交接包含了先前工作會話的關鍵上下文、學習內容和後續步驟，需要被理解和繼續。

## 初始回應

當此指令被呼叫時：

1. **如果提供了交接文件的路徑**：
   - 如果交接文件路徑作為參數提供，跳過預設訊息
   - 立即完整閱讀交接文件
   - 立即閱讀它在 `thoughts/shared/plans` 或 `thoughts/shared/research` 下連結的任何研究或計畫文件。不要使用子代理來閱讀這些關鍵檔案。
   - 透過從交接文件中擷取相關上下文來開始分析過程，閱讀它提到的其他檔案
   - 然後向使用者提出行動方案並確認，或要求澄清方向。

2. **如果提供了工作項目編號（如 ENG-XXXX）**：
   - 執行 `humanlayer thoughts sync` 以確保你的 `thoughts/` 目錄是最新的。
   - 找到該工作項目最近的交接文件。工作項目將位於 `thoughts/shared/handoffs/ENG-XXXX`，其中 `ENG-XXXX` 是工作項目編號。例如，對於 `ENG-2124`，交接將位於 `thoughts/shared/handoffs/ENG-2124/`。**列出此目錄的內容。**
   - 目錄中可能有零個、一個或多個檔案。
   - **如果目錄中有零個檔案，或目錄不存在**：告訴使用者：「很抱歉，我似乎找不到該交接文件。你能提供路徑給我嗎？」
   - **如果目錄中只有一個檔案**：使用該交接繼續
   - **如果目錄中有多個檔案**：使用檔案名稱中指定的日期和時間（格式為 `YYYY-MM-DD_HH-MM-SS`，24 小時制），繼續處理最近的交接文件。
   - 立即完整閱讀交接文件
   - 立即閱讀它在 `thoughts/shared/plans` 或 `thoughts/shared/research` 下連結的任何研究或計畫文件；不要使用子代理來閱讀這些關鍵檔案。
   - 透過從交接文件中擷取相關上下文來開始分析過程，閱讀它提到的其他檔案
   - 然後向使用者提出行動方案並確認，或要求澄清方向。

3. **如果未提供參數**，回應：
```
我將協助你從交接文件恢復工作。讓我找到可用的交接。

你想從哪個交接恢復？

提示：你可以直接使用交接路徑呼叫此指令：`/resume_handoff `thoughts/shared/handoffs/ENG-XXXX/YYYY-MM-DD_HH-MM-SS_ENG-XXXX_description.md`

或使用工作項目編號從該工作項目的最近交接恢復：`/resume_handoff ENG-XXXX`
```

然後等待使用者的輸入。

## 處理步驟

### 步驟 1：閱讀和分析交接

1. **完整閱讀交接文件**：
   - 使用 Read 工具時不要使用 limit/offset 參數
   - 擷取所有區段：
     - 任務及其狀態
     - 最近的變更
     - 學習內容
     - 產出物
     - 行動項目和後續步驟
     - 其他註記

2. **產生集中的研究任務**：
   根據交接內容，產生平行研究任務以驗證當前狀態：

   ```
   任務 1 - 收集產出物上下文：
   閱讀交接中提到的所有產出物。
   1. 閱讀「產出物」中列出的功能文件
   2. 閱讀參照的實作計畫
   3. 閱讀提到的任何研究文件
   4. 擷取關鍵需求和決策
   使用工具：Read
   回傳：產出物內容和關鍵決策的摘要
   ```

3. **在繼續之前等待所有子任務完成**

4. **閱讀識別出的關鍵檔案**：
   - 完整閱讀「學習內容」區段的檔案
   - 閱讀「最近的變更」的檔案以理解修改
   - 閱讀研究期間發現的任何新相關檔案

### 步驟 2：綜合並呈現分析

1. **呈現綜合分析**：
   ```
   我已分析來自 [研究員] 在 [日期] 的交接。以下是當前情況：

   **原始任務：**
   - [任務 1]：[交接的狀態] → [當前驗證]
   - [任務 2]：[交接的狀態] → [當前驗證]

   **已驗證的關鍵學習內容：**
   - [具有 file:line 參照的學習] - [仍然有效/已變更]
   - [發現的模式] - [仍然適用/已修改]

   **最近變更狀態：**
   - [變更 1] - [已驗證存在/缺失/已修改]
   - [變更 2] - [已驗證存在/缺失/已修改]

   **已審查的產出物：**
   - [文件 1]：[關鍵要點]
   - [文件 2]：[關鍵要點]

   **建議的後續行動：**
   根據交接的行動項目和當前狀態：
   1. [基於交接的最合理的下一步]
   2. [第二優先級行動]
   3. [發現的其他任務]

   **識別的潛在問題：**
   - [發現的任何衝突或退化]
   - [缺失的相依性或損壞的程式碼]

   我應該繼續進行 [建議行動 1] 嗎，還是你想調整方法？
   ```

2. **在繼續之前取得確認**

### 步驟 3：建立行動計畫

1. **使用 TodoWrite 建立任務清單**：
   - 將交接的行動項目轉換為待辦事項
   - 新增分析期間發現的任何新任務
   - 根據相依性和交接指導進行優先排序

2. **呈現計畫**：
   ```
   我已根據交接和當前分析建立任務清單：

   [顯示待辦清單]

   準備好開始第一個任務了嗎：[任務描述]？
   ```

### 步驟 4：開始實作

1. **從第一個已批准的任務開始**
2. **在整個實作過程中參照交接的學習內容**
3. **應用交接中記錄的模式和方法**
4. **隨著任務完成更新進度**

## 指南

1. **在分析時要徹底**：
   - 首先閱讀整個交接文件
   - 驗證所有提到的變更仍然存在
   - 檢查任何退化或衝突
   - 閱讀所有參照的產出物

2. **保持互動**：
   - 在開始工作前呈現發現
   - 在方法上取得認同
   - 允許路線修正
   - 根據當前狀態與交接狀態進行調整

3. **利用交接智慧**：
   - 特別注意「學習內容」區段
   - 應用記錄的模式和方法
   - 避免重複提到的錯誤
   - 建立在已發現的解決方案之上

4. **追蹤連續性**：
   - 使用 TodoWrite 維持任務連續性
   - 在提交中參照交接文件
   - 記錄與原始計畫的任何偏差
   - 完成後考慮建立新的交接

5. **在行動前驗證**：
   - 永遠不要假設交接狀態與當前狀態相符
   - 驗證所有檔案參照仍然存在
   - 檢查自交接以來的破壞性變更
   - 確認模式仍然有效

## 常見情境

### 情境 1：順利延續
- 交接的所有變更都存在
- 沒有衝突或退化
- 行動項目中有明確的後續步驟
- 繼續進行建議的行動

### 情境 2：分岐的程式碼庫
- 一些變更缺失或已修改
- 自交接以來新增了新的相關程式碼
- 需要調和差異
- 根據當前狀態調整計畫

### 情境 3：未完成的交接工作
- 交接中標記為「in_progress」的任務
- 需要首先完成未完成的工作
- 可能需要重新理解部分實作
- 在新工作之前專注於完成

### 情境 4：過時的交接
- 已經過了相當長的時間
- 發生了重大重構
- 原始方法可能不再適用
- 需要重新評估策略

## 範例互動流程

```
User: /resume_handoff specification/feature/handoffs/handoff-0.md
Assistant: 讓我閱讀並分析該交接文件...

[完整閱讀交接]
[產生研究任務]
[等待完成]
[閱讀識別的檔案]

我已分析來自 [日期] 的交接。以下是當前情況...

[呈現分析]

我應該繼續實作 webhook 驗證修復，還是你想調整方法？

User: 是的，繼續進行 webhook 驗證
Assistant: [建立待辦清單並開始實作]
```
